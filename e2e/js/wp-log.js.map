{"version":3,"file":"wp-log.js","sources":["../../node_modules/tslib/tslib.es6.js","../../node_modules/idb/build/esm/wrap-idb-value.js","../../node_modules/idb/build/esm/index.js","../../src/constants.ts","../../src/util.ts","../../src/storage.ts","../../src/index.ts"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","const instanceOfAny = (object, constructors) => constructors.some((c) => object instanceof c);\n\nlet idbProxyableTypes;\nlet cursorAdvanceMethods;\n// This is a function to prevent it throwing up in node environments.\nfunction getIdbProxyableTypes() {\n    return (idbProxyableTypes ||\n        (idbProxyableTypes = [\n            IDBDatabase,\n            IDBObjectStore,\n            IDBIndex,\n            IDBCursor,\n            IDBTransaction,\n        ]));\n}\n// This is a function to prevent it throwing up in node environments.\nfunction getCursorAdvanceMethods() {\n    return (cursorAdvanceMethods ||\n        (cursorAdvanceMethods = [\n            IDBCursor.prototype.advance,\n            IDBCursor.prototype.continue,\n            IDBCursor.prototype.continuePrimaryKey,\n        ]));\n}\nconst cursorRequestMap = new WeakMap();\nconst transactionDoneMap = new WeakMap();\nconst transactionStoreNamesMap = new WeakMap();\nconst transformCache = new WeakMap();\nconst reverseTransformCache = new WeakMap();\nfunction promisifyRequest(request) {\n    const promise = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            request.removeEventListener('success', success);\n            request.removeEventListener('error', error);\n        };\n        const success = () => {\n            resolve(wrap(request.result));\n            unlisten();\n        };\n        const error = () => {\n            reject(request.error);\n            unlisten();\n        };\n        request.addEventListener('success', success);\n        request.addEventListener('error', error);\n    });\n    promise\n        .then((value) => {\n        // Since cursoring reuses the IDBRequest (*sigh*), we cache it for later retrieval\n        // (see wrapFunction).\n        if (value instanceof IDBCursor) {\n            cursorRequestMap.set(value, request);\n        }\n        // Catching to avoid \"Uncaught Promise exceptions\"\n    })\n        .catch(() => { });\n    // This mapping exists in reverseTransformCache but doesn't doesn't exist in transformCache. This\n    // is because we create many promises from a single IDBRequest.\n    reverseTransformCache.set(promise, request);\n    return promise;\n}\nfunction cacheDonePromiseForTransaction(tx) {\n    // Early bail if we've already created a done promise for this transaction.\n    if (transactionDoneMap.has(tx))\n        return;\n    const done = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            tx.removeEventListener('complete', complete);\n            tx.removeEventListener('error', error);\n            tx.removeEventListener('abort', error);\n        };\n        const complete = () => {\n            resolve();\n            unlisten();\n        };\n        const error = () => {\n            reject(tx.error || new DOMException('AbortError', 'AbortError'));\n            unlisten();\n        };\n        tx.addEventListener('complete', complete);\n        tx.addEventListener('error', error);\n        tx.addEventListener('abort', error);\n    });\n    // Cache it for later retrieval.\n    transactionDoneMap.set(tx, done);\n}\nlet idbProxyTraps = {\n    get(target, prop, receiver) {\n        if (target instanceof IDBTransaction) {\n            // Special handling for transaction.done.\n            if (prop === 'done')\n                return transactionDoneMap.get(target);\n            // Polyfill for objectStoreNames because of Edge.\n            if (prop === 'objectStoreNames') {\n                return target.objectStoreNames || transactionStoreNamesMap.get(target);\n            }\n            // Make tx.store return the only store in the transaction, or undefined if there are many.\n            if (prop === 'store') {\n                return receiver.objectStoreNames[1]\n                    ? undefined\n                    : receiver.objectStore(receiver.objectStoreNames[0]);\n            }\n        }\n        // Else transform whatever we get back.\n        return wrap(target[prop]);\n    },\n    set(target, prop, value) {\n        target[prop] = value;\n        return true;\n    },\n    has(target, prop) {\n        if (target instanceof IDBTransaction &&\n            (prop === 'done' || prop === 'store')) {\n            return true;\n        }\n        return prop in target;\n    },\n};\nfunction replaceTraps(callback) {\n    idbProxyTraps = callback(idbProxyTraps);\n}\nfunction wrapFunction(func) {\n    // Due to expected object equality (which is enforced by the caching in `wrap`), we\n    // only create one new func per func.\n    // Edge doesn't support objectStoreNames (booo), so we polyfill it here.\n    if (func === IDBDatabase.prototype.transaction &&\n        !('objectStoreNames' in IDBTransaction.prototype)) {\n        return function (storeNames, ...args) {\n            const tx = func.call(unwrap(this), storeNames, ...args);\n            transactionStoreNamesMap.set(tx, storeNames.sort ? storeNames.sort() : [storeNames]);\n            return wrap(tx);\n        };\n    }\n    // Cursor methods are special, as the behaviour is a little more different to standard IDB. In\n    // IDB, you advance the cursor and wait for a new 'success' on the IDBRequest that gave you the\n    // cursor. It's kinda like a promise that can resolve with many values. That doesn't make sense\n    // with real promises, so each advance methods returns a new promise for the cursor object, or\n    // undefined if the end of the cursor has been reached.\n    if (getCursorAdvanceMethods().includes(func)) {\n        return function (...args) {\n            // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n            // the original object.\n            func.apply(unwrap(this), args);\n            return wrap(cursorRequestMap.get(this));\n        };\n    }\n    return function (...args) {\n        // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n        // the original object.\n        return wrap(func.apply(unwrap(this), args));\n    };\n}\nfunction transformCachableValue(value) {\n    if (typeof value === 'function')\n        return wrapFunction(value);\n    // This doesn't return, it just creates a 'done' promise for the transaction,\n    // which is later returned for transaction.done (see idbObjectHandler).\n    if (value instanceof IDBTransaction)\n        cacheDonePromiseForTransaction(value);\n    if (instanceOfAny(value, getIdbProxyableTypes()))\n        return new Proxy(value, idbProxyTraps);\n    // Return the same value back if we're not going to transform it.\n    return value;\n}\nfunction wrap(value) {\n    // We sometimes generate multiple promises from a single IDBRequest (eg when cursoring), because\n    // IDB is weird and a single IDBRequest can yield many responses, so these can't be cached.\n    if (value instanceof IDBRequest)\n        return promisifyRequest(value);\n    // If we've already transformed this value before, reuse the transformed value.\n    // This is faster, but it also provides object equality.\n    if (transformCache.has(value))\n        return transformCache.get(value);\n    const newValue = transformCachableValue(value);\n    // Not all types are transformed.\n    // These may be primitive types, so they can't be WeakMap keys.\n    if (newValue !== value) {\n        transformCache.set(value, newValue);\n        reverseTransformCache.set(newValue, value);\n    }\n    return newValue;\n}\nconst unwrap = (value) => reverseTransformCache.get(value);\n\nexport { reverseTransformCache as a, instanceOfAny as i, replaceTraps as r, unwrap as u, wrap as w };\n","import { w as wrap, r as replaceTraps } from './wrap-idb-value.js';\nexport { u as unwrap, w as wrap } from './wrap-idb-value.js';\n\n/**\n * Open a database.\n *\n * @param name Name of the database.\n * @param version Schema version.\n * @param callbacks Additional callbacks.\n */\nfunction openDB(name, version, { blocked, upgrade, blocking, terminated } = {}) {\n    const request = indexedDB.open(name, version);\n    const openPromise = wrap(request);\n    if (upgrade) {\n        request.addEventListener('upgradeneeded', (event) => {\n            upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction));\n        });\n    }\n    if (blocked)\n        request.addEventListener('blocked', () => blocked());\n    openPromise\n        .then((db) => {\n        if (terminated)\n            db.addEventListener('close', () => terminated());\n        if (blocking)\n            db.addEventListener('versionchange', () => blocking());\n    })\n        .catch(() => { });\n    return openPromise;\n}\n/**\n * Delete a database.\n *\n * @param name Name of the database.\n */\nfunction deleteDB(name, { blocked } = {}) {\n    const request = indexedDB.deleteDatabase(name);\n    if (blocked)\n        request.addEventListener('blocked', () => blocked());\n    return wrap(request).then(() => undefined);\n}\n\nconst readMethods = ['get', 'getKey', 'getAll', 'getAllKeys', 'count'];\nconst writeMethods = ['put', 'add', 'delete', 'clear'];\nconst cachedMethods = new Map();\nfunction getMethod(target, prop) {\n    if (!(target instanceof IDBDatabase &&\n        !(prop in target) &&\n        typeof prop === 'string')) {\n        return;\n    }\n    if (cachedMethods.get(prop))\n        return cachedMethods.get(prop);\n    const targetFuncName = prop.replace(/FromIndex$/, '');\n    const useIndex = prop !== targetFuncName;\n    const isWrite = writeMethods.includes(targetFuncName);\n    if (\n    // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.\n    !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) ||\n        !(isWrite || readMethods.includes(targetFuncName))) {\n        return;\n    }\n    const method = async function (storeName, ...args) {\n        // isWrite ? 'readwrite' : undefined gzipps better, but fails in Edge :(\n        const tx = this.transaction(storeName, isWrite ? 'readwrite' : 'readonly');\n        let target = tx.store;\n        if (useIndex)\n            target = target.index(args.shift());\n        const returnVal = await target[targetFuncName](...args);\n        if (isWrite)\n            await tx.done;\n        return returnVal;\n    };\n    cachedMethods.set(prop, method);\n    return method;\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),\n    has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop),\n}));\n\nexport { deleteDB, openDB };\n","export var VERSION = '0.1.0';\nexport var DATABASE_NAME = 'WoodpeckerLog';\nexport var OBJECT_STORE_APP_STATUS = 'appStatus';\nexport var OBJECT_STORE_LOG_DETAIL = 'logDetails';\nexport var DATABASE_VERSION = 1;\nexport var M_BYTES = 1024 * 1024;\nexport var DAY_MILLISECONDS = 24 * 60 * 60 * 1000;\nexport var APP_KEY_ANONYMOUS = '$anonymous';\nexport var ERRORS;\n(function (ERRORS) {\n    ERRORS[\"ERR_CONFIG_SDK_INIT_OPTION\"] = \"[WoodpeckerLog] Invalid option type.\";\n    ERRORS[\"ERR_STORAGE\"] = \"[WoodpeckerLog] Log storage not support indexDB or fill full.\";\n    ERRORS[\"ERR_QUERY_DATE_PARAMETER\"] = \"[WoodpeckerLog] queryByDate parameter should be a valid date number.\";\n    ERRORS[\"ERR_NOT_SUPPORTED\"] = \"[WoodpeckerLog] not supported.\";\n})(ERRORS || (ERRORS = {}));\nexport var MESSAGES;\n(function (MESSAGES) {\n    MESSAGES[\"MESSAGE_LOG_TOTALSIZE\"] = \"[WoodpeckerLog] log totalSize %s\";\n    MESSAGES[\"MESSAGE_LOG_ITEMS\"] = \"[WoodpeckerLog] log items\";\n})(MESSAGES || (MESSAGES = {}));\n","import { __awaiter, __generator } from \"tslib\";\nvar queue = [];\nvar isCandidatePending = false;\nexport function isBrowser() {\n    return typeof window !== 'undefined' && window.location !== undefined;\n}\nexport function wrapContent(content, level) {\n    return {\n        c: content,\n        l: level,\n        t: Date.now()\n    };\n}\nexport function getContentLength(content) {\n    return content.c.length;\n}\nexport function devConsole(debug) {\n    var args = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        args[_i - 1] = arguments[_i];\n    }\n    debug && console.log.apply(console, args);\n}\nfunction doPromiseInQueue() {\n    return __awaiter(this, void 0, void 0, function () {\n        var candidate, lastResult, err_1;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    if (!(queue.length && !isCandidatePending)) return [3, 6];\n                    isCandidatePending = true;\n                    candidate = queue.shift();\n                    _a.label = 1;\n                case 1:\n                    _a.trys.push([1, 3, , 4]);\n                    return [4, candidate.asyncFunction()];\n                case 2:\n                    lastResult = _a.sent();\n                    candidate.resolve(lastResult);\n                    return [3, 4];\n                case 3:\n                    err_1 = _a.sent();\n                    candidate.reject(err_1);\n                    return [3, 4];\n                case 4:\n                    isCandidatePending = false;\n                    doPromiseInQueue();\n                    return [4, candidate];\n                case 5:\n                    _a.sent();\n                    return [3, 0];\n                case 6: return [2];\n            }\n        });\n    });\n}\nexport function inQueue(asyncFunction) {\n    return __awaiter(this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n            return [2, new Promise(function (resolve, reject) {\n                    queue.push({\n                        asyncFunction: asyncFunction,\n                        resolve: resolve,\n                        reject: reject\n                    });\n                    doPromiseInQueue();\n                })];\n        });\n    });\n}\n","import { __awaiter, __generator } from \"tslib\";\nimport { openDB, deleteDB } from 'idb';\nimport { MESSAGES } from './constants';\nimport { DATABASE_NAME, OBJECT_STORE_APP_STATUS, OBJECT_STORE_LOG_DETAIL, DATABASE_VERSION } from './constants';\nimport { getContentLength, inQueue, devConsole } from './util';\nexport function isSupportIndexDB() {\n    if (!window.indexedDB || !window.IDBKeyRange) {\n        return false;\n    }\n    return true;\n}\nfunction filterByAppKey(items, appKey) {\n    var returned = items.filter(function (item) {\n        return item.appKey === appKey;\n    });\n    return returned;\n}\nfunction asyncOpenDB() {\n    return __awaiter(this, void 0, void 0, function () {\n        var db;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4, openDB(DATABASE_NAME, DATABASE_VERSION, {\n                        upgrade: function (db) {\n                            var appListStore = db.createObjectStore(OBJECT_STORE_APP_STATUS);\n                            var logDetailsStore = db.createObjectStore(OBJECT_STORE_LOG_DETAIL, {\n                                keyPath: 'id',\n                                autoIncrement: true\n                            });\n                            logDetailsStore.createIndex('createTime', 'createTime');\n                            logDetailsStore.createIndex('appKey', 'appKey');\n                        }\n                    })];\n                case 1:\n                    db = _a.sent();\n                    return [2, db];\n            }\n        });\n    });\n}\nexport function asyncDeleteDB() {\n    return __awaiter(this, void 0, void 0, function () {\n        var result;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4, deleteDB(DATABASE_NAME)];\n                case 1:\n                    result = _a.sent();\n                    return [2, result];\n            }\n        });\n    });\n}\nexport function asyncSave(bytesQuota, appKey, content, debug) {\n    return __awaiter(this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4, inQueue(function () {\n                        return __awaiter(this, void 0, void 0, function () {\n                            var db, appTotalSize, totalSizeItem, lastTotalSize, now, item;\n                            return __generator(this, function (_a) {\n                                switch (_a.label) {\n                                    case 0: return [4, asyncOpenDB()];\n                                    case 1:\n                                        db = _a.sent();\n                                        appTotalSize = 0;\n                                        return [4, db.get(OBJECT_STORE_APP_STATUS, 'totalSize')];\n                                    case 2:\n                                        totalSizeItem = _a.sent();\n                                        lastTotalSize = totalSizeItem ? totalSizeItem.totalSize : 0;\n                                        appTotalSize += lastTotalSize;\n                                        appTotalSize += getContentLength(content);\n                                        devConsole(debug, MESSAGES.MESSAGE_LOG_TOTALSIZE, appTotalSize);\n                                        if (!(appTotalSize <= bytesQuota)) return [3, 5];\n                                        now = Date.now();\n                                        return [4, db.add(OBJECT_STORE_LOG_DETAIL, {\n                                                createTime: now,\n                                                appKey: appKey,\n                                                content: content\n                                            })];\n                                    case 3:\n                                        item = _a.sent();\n                                        return [4, db.put(OBJECT_STORE_APP_STATUS, {\n                                                totalSize: appTotalSize\n                                            }, 'totalSize')];\n                                    case 4:\n                                        _a.sent();\n                                        db.close();\n                                        return [2, item];\n                                    case 5:\n                                        console.error('存满');\n                                        return [2, null];\n                                }\n                            });\n                        });\n                    })];\n                case 1: return [2, _a.sent()];\n            }\n        });\n    });\n}\nexport function asyncGetByDateRange(appKey, startDate, endDate, debug) {\n    return __awaiter(this, void 0, void 0, function () {\n        var db, items;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4, asyncOpenDB()];\n                case 1:\n                    db = _a.sent();\n                    return [4, db.getAll(OBJECT_STORE_LOG_DETAIL, IDBKeyRange.bound(startDate, endDate))];\n                case 2:\n                    items = _a.sent();\n                    db.close();\n                    devConsole(debug, MESSAGES.MESSAGE_LOG_ITEMS, items);\n                    return [2, filterByAppKey(items, appKey)];\n            }\n        });\n    });\n}\nexport function asyncQueryByContent(appKey, queryStr, debug) {\n    return __awaiter(this, void 0, void 0, function () {\n        var db, items, cursor, content;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4, asyncOpenDB()];\n                case 1:\n                    db = _a.sent();\n                    items = [];\n                    return [4, db\n                            .transaction(OBJECT_STORE_LOG_DETAIL, 'readwrite')\n                            .store.index('createTime')\n                            .openCursor()];\n                case 2:\n                    cursor = _a.sent();\n                    _a.label = 3;\n                case 3:\n                    if (!cursor) return [3, 5];\n                    content = cursor.value.content;\n                    if (content.c.indexOf(queryStr) > -1) {\n                        items.push(cursor.value);\n                    }\n                    return [4, cursor.continue()];\n                case 4:\n                    cursor = _a.sent();\n                    return [3, 3];\n                case 5:\n                    devConsole(debug, MESSAGES.MESSAGE_LOG_ITEMS, items);\n                    return [2, filterByAppKey(items, appKey)];\n            }\n        });\n    });\n}\n","import { __awaiter, __decorate, __generator } from \"tslib\";\nimport { isSupportIndexDB, asyncSave, asyncGetByDateRange, asyncQueryByContent, asyncDeleteDB } from './storage';\nimport { isBrowser, wrapContent } from './util';\nimport { ERRORS, M_BYTES, APP_KEY_ANONYMOUS } from './constants';\nvar notInBrowser = !isBrowser();\nfunction noop() { }\nfunction verifyInBrowser(target, propertyKey, descriptor) {\n    var originalFunc = descriptor.value;\n    descriptor.value = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        return __awaiter(this, void 0, void 0, function () {\n            var result;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (notInBrowser)\n                            return [2, Promise.reject(ERRORS.ERR_NOT_SUPPORTED)];\n                        return [4, originalFunc.apply(this, args)];\n                    case 1:\n                        result = _a.sent();\n                        return [2, result];\n                }\n            });\n        });\n    };\n}\nfunction proxySaveLog(level) {\n    if (notInBrowser)\n        return noop;\n    return function saveLog(bytesQuota, appKey, content, debug) {\n        if (!isSupportIndexDB()) {\n            throw new Error(ERRORS.ERR_STORAGE);\n        }\n        var wrappedContent = wrapContent(content, level);\n        var asyncSaveCallback = asyncSave(bytesQuota, appKey, wrappedContent, debug);\n        return asyncSaveCallback;\n    };\n}\nvar WoodpeckerLogger = (function () {\n    function WoodpeckerLogger(_a) {\n        var _b = _a === void 0 ? {} : _a, _c = _b.appKey, appKey = _c === void 0 ? APP_KEY_ANONYMOUS : _c, _d = _b.bytesQuota, bytesQuota = _d === void 0 ? 10 * M_BYTES : _d, reportUrl = _b.reportUrl, _e = _b.enableSendBeacon, enableSendBeacon = _e === void 0 ? false : _e, _f = _b.debug, debug = _f === void 0 ? false : _f;\n        if (notInBrowser)\n            return;\n        if (typeof appKey !== 'string' ||\n            typeof bytesQuota !== 'number' ||\n            (reportUrl && typeof reportUrl !== 'string')) {\n            throw new Error(ERRORS.ERR_CONFIG_SDK_INIT_OPTION);\n        }\n        this.options = {\n            appKey: appKey,\n            bytesQuota: bytesQuota,\n            reportUrl: reportUrl,\n            enableSendBeacon: enableSendBeacon,\n            debug: debug\n        };\n    }\n    WoodpeckerLogger.prototype.log = function (content) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2, proxySaveLog('log')(this.options.bytesQuota, this.options.appKey, content, this.options.debug)];\n            });\n        });\n    };\n    WoodpeckerLogger.prototype.debug = function (content) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2, proxySaveLog('debug')(this.options.bytesQuota, this.options.appKey, content, this.options.debug)];\n            });\n        });\n    };\n    WoodpeckerLogger.prototype.info = function (content) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2, proxySaveLog('info')(this.options.bytesQuota, this.options.appKey, content, this.options.debug)];\n            });\n        });\n    };\n    WoodpeckerLogger.prototype.warn = function (content) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2, proxySaveLog('warn')(this.options.bytesQuota, this.options.appKey, content, this.options.debug)];\n            });\n        });\n    };\n    WoodpeckerLogger.prototype.error = function (content) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2, proxySaveLog('error')(this.options.bytesQuota, this.options.appKey, content, this.options.debug)];\n            });\n        });\n    };\n    WoodpeckerLogger.prototype.deleteLogDB = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4, asyncDeleteDB()];\n                    case 1: return [2, _a.sent()];\n                }\n            });\n        });\n    };\n    WoodpeckerLogger.prototype.queryByDate = function (startDate, endDate) {\n        if (startDate === void 0) { startDate = new Date(new Date().getDate() - 1).getTime(); }\n        if (endDate === void 0) { endDate = new Date().getTime(); }\n        return __awaiter(this, void 0, void 0, function () {\n            var queryResult;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (typeof startDate !== 'number' || typeof endDate !== 'number') {\n                            throw new Error(ERRORS.ERR_QUERY_DATE_PARAMETER);\n                        }\n                        return [4, asyncGetByDateRange(this.options.appKey, startDate, endDate, this.options.debug)];\n                    case 1:\n                        queryResult = _a.sent();\n                        return [2, queryResult];\n                }\n            });\n        });\n    };\n    WoodpeckerLogger.prototype.queryByContent = function (content) {\n        return __awaiter(this, void 0, void 0, function () {\n            var queryResult;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4, asyncQueryByContent(this.options.appKey, content, this.options.debug)];\n                    case 1:\n                        queryResult = _a.sent();\n                        return [2, queryResult];\n                }\n            });\n        });\n    };\n    WoodpeckerLogger.prototype.report = function (_a) {\n        var startDate = _a.startDate, days = _a.days, deviceId = _a.deviceId, environment = _a.environment, extraInfo = _a.extraInfo;\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_b) {\n                if (notInBrowser)\n                    return [2, noop];\n                return [2];\n            });\n        });\n    };\n    __decorate([\n        verifyInBrowser\n    ], WoodpeckerLogger.prototype, \"queryByDate\", null);\n    __decorate([\n        verifyInBrowser\n    ], WoodpeckerLogger.prototype, \"queryByContent\", null);\n    __decorate([\n        verifyInBrowser\n    ], WoodpeckerLogger.prototype, \"report\", null);\n    return WoodpeckerLogger;\n}());\nexport default WoodpeckerLogger;\n"],"names":["__decorate","decorators","target","key","desc","d","c","arguments","length","r","Object","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","__generator","body","f","y","t","g","_","label","sent","trys","ops","verb","throw","return","Symbol","iterator","this","n","v","op","TypeError","call","pop","push","idbProxyableTypes","cursorAdvanceMethods","cursorRequestMap","WeakMap","transactionDoneMap","transactionStoreNamesMap","transformCache","reverseTransformCache","idbProxyTraps","[object Object]","prop","receiver","IDBTransaction","get","objectStoreNames","undefined","objectStore","wrap","set","has","wrapFunction","func","IDBDatabase","prototype","transaction","IDBCursor","advance","continue","continuePrimaryKey","includes","args","unwrap","storeNames","tx","sort","transformCachableValue","unlisten","removeEventListener","complete","error","DOMException","addEventListener","cacheDonePromiseForTransaction","object","IDBObjectStore","IDBIndex","some","Proxy","IDBRequest","request","promise","success","catch","promisifyRequest","newValue","openDB","name","version","blocked","upgrade","blocking","terminated","indexedDB","open","openPromise","event","oldVersion","newVersion","db","deleteDB","deleteDatabase","readMethods","writeMethods","cachedMethods","Map","getMethod","targetFuncName","replace","useIndex","isWrite","method","async","storeName","store","index","shift","returnVal","oldTraps","callback","ERRORS","MESSAGES","DATABASE_NAME","OBJECT_STORE_APP_STATUS","OBJECT_STORE_LOG_DETAIL","queue","isCandidatePending","devConsole","debug","_i","console","log","doPromiseInQueue","candidate","lastResult","err_1","_a","asyncFunction","inQueue","filterByAppKey","items","appKey","filter","item","asyncOpenDB","createObjectStore","logDetailsStore","keyPath","autoIncrement","createIndex","asyncDeleteDB","asyncGetByDateRange","startDate","endDate","getAll","IDBKeyRange","bound","close","MESSAGE_LOG_ITEMS","asyncQueryByContent","queryStr","cursor","openCursor","content","indexOf","notInBrowser","window","location","noop","verifyInBrowser","propertyKey","descriptor","originalFunc","ERR_NOT_SUPPORTED","proxySaveLog","level","bytesQuota","Error","ERR_STORAGE","appTotalSize","totalSizeItem","lastTotalSize","now","totalSize","getContentLength","MESSAGE_LOG_TOTALSIZE","Date","add","createTime","put","asyncSave","l","wrapContent","WoodpeckerLogger","_b","_c","_d","reportUrl","_e","enableSendBeacon","_f","ERR_CONFIG_SDK_INIT_OPTION","options","info","warn","deleteLogDB","queryByDate","getDate","getTime","ERR_QUERY_DATE_PARAMETER","queryByContent","report","days","deviceId","environment","extraInfo"],"mappings":"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"}