{"version":3,"file":"wp-log.js","sources":["../../node_modules/tslib/tslib.es6.js","../../src/constants.ts","../../src/interface.ts","../../node_modules/idb/build/esm/wrap-idb-value.js","../../node_modules/idb/build/esm/index.js","../../src/util.ts","../../src/storage.ts","../../src/env.ts","../../src/http.ts","../../src/report.ts","../../src/index.ts"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","export var VERSION = '0.1.0';\nexport var DATABASE_NAME = 'WoodpeckerLog';\nexport var OBJECT_STORE_APP_STATUS = 'appStatus';\nexport var OBJECT_STORE_LOG_DETAIL = 'logDetails';\nexport var DATABASE_VERSION = 1;\nexport var M_BYTES = 1024 * 1024;\nexport var DAY_MILLISECONDS = 24 * 60 * 60 * 1000;\nexport var APP_KEY_ANONYMOUS = '$anonymous';\nexport var ERRORS;\n(function (ERRORS) {\n    ERRORS[\"ERR_CONFIG_SDK_INIT_OPTION\"] = \"Invalid option type.\";\n    ERRORS[\"ERR_STORAGE\"] = \"Log storage not support indexDB or fill full.\";\n    ERRORS[\"ERR_QUERY_DATE_PARAMETER\"] = \"days parameter should be a valid number.\";\n    ERRORS[\"ERR_NOT_SUPPORTED\"] = \"not supported.\";\n})(ERRORS || (ERRORS = {}));\nexport var MESSAGES;\n(function (MESSAGES) {\n    MESSAGES[\"MESSAGE_REPORT_URL\"] = \"report url is empty\";\n    MESSAGES[\"MESSAGE_LOG_CONTENT\"] = \"save log content\";\n    MESSAGES[\"MESSAGE_LOG_TOTALSIZE\"] = \"total log size\";\n    MESSAGES[\"MESSAGE_LOG_ITEMS\"] = \"query result log items\";\n})(MESSAGES || (MESSAGES = {}));\n","import { OBJECT_STORE_APP_STATUS, OBJECT_STORE_LOG_DETAIL } from './constants';\nexport var levelEnum;\n(function (levelEnum) {\n    levelEnum[levelEnum[\"trace\"] = 1] = \"trace\";\n    levelEnum[levelEnum[\"info\"] = 2] = \"info\";\n    levelEnum[levelEnum[\"warn\"] = 3] = \"warn\";\n    levelEnum[levelEnum[\"error\"] = 4] = \"error\";\n    levelEnum[levelEnum[\"fatal\"] = 5] = \"fatal\";\n    levelEnum[levelEnum[\"assert\"] = 6] = \"assert\";\n})(levelEnum || (levelEnum = {}));\n","const instanceOfAny = (object, constructors) => constructors.some((c) => object instanceof c);\n\nlet idbProxyableTypes;\nlet cursorAdvanceMethods;\n// This is a function to prevent it throwing up in node environments.\nfunction getIdbProxyableTypes() {\n    return (idbProxyableTypes ||\n        (idbProxyableTypes = [\n            IDBDatabase,\n            IDBObjectStore,\n            IDBIndex,\n            IDBCursor,\n            IDBTransaction,\n        ]));\n}\n// This is a function to prevent it throwing up in node environments.\nfunction getCursorAdvanceMethods() {\n    return (cursorAdvanceMethods ||\n        (cursorAdvanceMethods = [\n            IDBCursor.prototype.advance,\n            IDBCursor.prototype.continue,\n            IDBCursor.prototype.continuePrimaryKey,\n        ]));\n}\nconst cursorRequestMap = new WeakMap();\nconst transactionDoneMap = new WeakMap();\nconst transactionStoreNamesMap = new WeakMap();\nconst transformCache = new WeakMap();\nconst reverseTransformCache = new WeakMap();\nfunction promisifyRequest(request) {\n    const promise = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            request.removeEventListener('success', success);\n            request.removeEventListener('error', error);\n        };\n        const success = () => {\n            resolve(wrap(request.result));\n            unlisten();\n        };\n        const error = () => {\n            reject(request.error);\n            unlisten();\n        };\n        request.addEventListener('success', success);\n        request.addEventListener('error', error);\n    });\n    promise\n        .then((value) => {\n        // Since cursoring reuses the IDBRequest (*sigh*), we cache it for later retrieval\n        // (see wrapFunction).\n        if (value instanceof IDBCursor) {\n            cursorRequestMap.set(value, request);\n        }\n        // Catching to avoid \"Uncaught Promise exceptions\"\n    })\n        .catch(() => { });\n    // This mapping exists in reverseTransformCache but doesn't doesn't exist in transformCache. This\n    // is because we create many promises from a single IDBRequest.\n    reverseTransformCache.set(promise, request);\n    return promise;\n}\nfunction cacheDonePromiseForTransaction(tx) {\n    // Early bail if we've already created a done promise for this transaction.\n    if (transactionDoneMap.has(tx))\n        return;\n    const done = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            tx.removeEventListener('complete', complete);\n            tx.removeEventListener('error', error);\n            tx.removeEventListener('abort', error);\n        };\n        const complete = () => {\n            resolve();\n            unlisten();\n        };\n        const error = () => {\n            reject(tx.error || new DOMException('AbortError', 'AbortError'));\n            unlisten();\n        };\n        tx.addEventListener('complete', complete);\n        tx.addEventListener('error', error);\n        tx.addEventListener('abort', error);\n    });\n    // Cache it for later retrieval.\n    transactionDoneMap.set(tx, done);\n}\nlet idbProxyTraps = {\n    get(target, prop, receiver) {\n        if (target instanceof IDBTransaction) {\n            // Special handling for transaction.done.\n            if (prop === 'done')\n                return transactionDoneMap.get(target);\n            // Polyfill for objectStoreNames because of Edge.\n            if (prop === 'objectStoreNames') {\n                return target.objectStoreNames || transactionStoreNamesMap.get(target);\n            }\n            // Make tx.store return the only store in the transaction, or undefined if there are many.\n            if (prop === 'store') {\n                return receiver.objectStoreNames[1]\n                    ? undefined\n                    : receiver.objectStore(receiver.objectStoreNames[0]);\n            }\n        }\n        // Else transform whatever we get back.\n        return wrap(target[prop]);\n    },\n    set(target, prop, value) {\n        target[prop] = value;\n        return true;\n    },\n    has(target, prop) {\n        if (target instanceof IDBTransaction &&\n            (prop === 'done' || prop === 'store')) {\n            return true;\n        }\n        return prop in target;\n    },\n};\nfunction replaceTraps(callback) {\n    idbProxyTraps = callback(idbProxyTraps);\n}\nfunction wrapFunction(func) {\n    // Due to expected object equality (which is enforced by the caching in `wrap`), we\n    // only create one new func per func.\n    // Edge doesn't support objectStoreNames (booo), so we polyfill it here.\n    if (func === IDBDatabase.prototype.transaction &&\n        !('objectStoreNames' in IDBTransaction.prototype)) {\n        return function (storeNames, ...args) {\n            const tx = func.call(unwrap(this), storeNames, ...args);\n            transactionStoreNamesMap.set(tx, storeNames.sort ? storeNames.sort() : [storeNames]);\n            return wrap(tx);\n        };\n    }\n    // Cursor methods are special, as the behaviour is a little more different to standard IDB. In\n    // IDB, you advance the cursor and wait for a new 'success' on the IDBRequest that gave you the\n    // cursor. It's kinda like a promise that can resolve with many values. That doesn't make sense\n    // with real promises, so each advance methods returns a new promise for the cursor object, or\n    // undefined if the end of the cursor has been reached.\n    if (getCursorAdvanceMethods().includes(func)) {\n        return function (...args) {\n            // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n            // the original object.\n            func.apply(unwrap(this), args);\n            return wrap(cursorRequestMap.get(this));\n        };\n    }\n    return function (...args) {\n        // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n        // the original object.\n        return wrap(func.apply(unwrap(this), args));\n    };\n}\nfunction transformCachableValue(value) {\n    if (typeof value === 'function')\n        return wrapFunction(value);\n    // This doesn't return, it just creates a 'done' promise for the transaction,\n    // which is later returned for transaction.done (see idbObjectHandler).\n    if (value instanceof IDBTransaction)\n        cacheDonePromiseForTransaction(value);\n    if (instanceOfAny(value, getIdbProxyableTypes()))\n        return new Proxy(value, idbProxyTraps);\n    // Return the same value back if we're not going to transform it.\n    return value;\n}\nfunction wrap(value) {\n    // We sometimes generate multiple promises from a single IDBRequest (eg when cursoring), because\n    // IDB is weird and a single IDBRequest can yield many responses, so these can't be cached.\n    if (value instanceof IDBRequest)\n        return promisifyRequest(value);\n    // If we've already transformed this value before, reuse the transformed value.\n    // This is faster, but it also provides object equality.\n    if (transformCache.has(value))\n        return transformCache.get(value);\n    const newValue = transformCachableValue(value);\n    // Not all types are transformed.\n    // These may be primitive types, so they can't be WeakMap keys.\n    if (newValue !== value) {\n        transformCache.set(value, newValue);\n        reverseTransformCache.set(newValue, value);\n    }\n    return newValue;\n}\nconst unwrap = (value) => reverseTransformCache.get(value);\n\nexport { reverseTransformCache as a, instanceOfAny as i, replaceTraps as r, unwrap as u, wrap as w };\n","import { w as wrap, r as replaceTraps } from './wrap-idb-value.js';\nexport { u as unwrap, w as wrap } from './wrap-idb-value.js';\n\n/**\n * Open a database.\n *\n * @param name Name of the database.\n * @param version Schema version.\n * @param callbacks Additional callbacks.\n */\nfunction openDB(name, version, { blocked, upgrade, blocking, terminated } = {}) {\n    const request = indexedDB.open(name, version);\n    const openPromise = wrap(request);\n    if (upgrade) {\n        request.addEventListener('upgradeneeded', (event) => {\n            upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction));\n        });\n    }\n    if (blocked)\n        request.addEventListener('blocked', () => blocked());\n    openPromise\n        .then((db) => {\n        if (terminated)\n            db.addEventListener('close', () => terminated());\n        if (blocking)\n            db.addEventListener('versionchange', () => blocking());\n    })\n        .catch(() => { });\n    return openPromise;\n}\n/**\n * Delete a database.\n *\n * @param name Name of the database.\n */\nfunction deleteDB(name, { blocked } = {}) {\n    const request = indexedDB.deleteDatabase(name);\n    if (blocked)\n        request.addEventListener('blocked', () => blocked());\n    return wrap(request).then(() => undefined);\n}\n\nconst readMethods = ['get', 'getKey', 'getAll', 'getAllKeys', 'count'];\nconst writeMethods = ['put', 'add', 'delete', 'clear'];\nconst cachedMethods = new Map();\nfunction getMethod(target, prop) {\n    if (!(target instanceof IDBDatabase &&\n        !(prop in target) &&\n        typeof prop === 'string')) {\n        return;\n    }\n    if (cachedMethods.get(prop))\n        return cachedMethods.get(prop);\n    const targetFuncName = prop.replace(/FromIndex$/, '');\n    const useIndex = prop !== targetFuncName;\n    const isWrite = writeMethods.includes(targetFuncName);\n    if (\n    // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.\n    !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) ||\n        !(isWrite || readMethods.includes(targetFuncName))) {\n        return;\n    }\n    const method = async function (storeName, ...args) {\n        // isWrite ? 'readwrite' : undefined gzipps better, but fails in Edge :(\n        const tx = this.transaction(storeName, isWrite ? 'readwrite' : 'readonly');\n        let target = tx.store;\n        if (useIndex)\n            target = target.index(args.shift());\n        const returnVal = await target[targetFuncName](...args);\n        if (isWrite)\n            await tx.done;\n        return returnVal;\n    };\n    cachedMethods.set(prop, method);\n    return method;\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),\n    has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop),\n}));\n\nexport { deleteDB, openDB };\n","import { __awaiter, __generator } from \"tslib\";\nvar queue = [];\nvar isCandidatePending = false;\nexport function isBrowser() {\n    return typeof window !== 'undefined' && window.location !== undefined;\n}\nexport function wrapContent(content, level, url, userId) {\n    return {\n        c: content,\n        l: level,\n        t: Date.now(),\n        ul: url,\n        ud: userId\n    };\n}\nexport function getContentLength(content) {\n    var json = JSON.stringify(content);\n    return json.length;\n}\nexport function devConsole(enableConsole) {\n    var args = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        args[_i - 1] = arguments[_i];\n    }\n    args.unshift('[WoodpeckerLog] ');\n    enableConsole && console.log.apply(console, args);\n}\nfunction doPromiseInQueue() {\n    return __awaiter(this, void 0, void 0, function () {\n        var candidate, lastResult, err_1;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    if (!(queue.length && !isCandidatePending)) return [3, 6];\n                    isCandidatePending = true;\n                    candidate = queue.shift();\n                    _a.label = 1;\n                case 1:\n                    _a.trys.push([1, 3, , 4]);\n                    return [4, candidate.asyncFunction()];\n                case 2:\n                    lastResult = _a.sent();\n                    candidate.resolve(lastResult);\n                    return [3, 4];\n                case 3:\n                    err_1 = _a.sent();\n                    candidate.reject(err_1);\n                    return [3, 4];\n                case 4:\n                    isCandidatePending = false;\n                    doPromiseInQueue();\n                    return [4, candidate];\n                case 5:\n                    _a.sent();\n                    return [3, 0];\n                case 6: return [2];\n            }\n        });\n    });\n}\nexport function inQueue(asyncFunction) {\n    return __awaiter(this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n            return [2, new Promise(function (resolve, reject) {\n                    queue.push({\n                        asyncFunction: asyncFunction,\n                        resolve: resolve,\n                        reject: reject\n                    });\n                    doPromiseInQueue();\n                })];\n        });\n    });\n}\nexport function debounce(method, time) {\n    if (time === void 0) { time = 100; }\n    var timeout;\n    return function () {\n        clearTimeout(timeout);\n        timeout = setTimeout(function () {\n            return method.apply(this, arguments);\n        }, time);\n    };\n}\n","import { __awaiter, __generator } from \"tslib\";\nimport { openDB, deleteDB } from 'idb';\nimport { MESSAGES } from './constants';\nimport { DATABASE_NAME, OBJECT_STORE_APP_STATUS, OBJECT_STORE_LOG_DETAIL, DATABASE_VERSION } from './constants';\nimport { getContentLength, inQueue, devConsole } from './util';\nexport function isSupportIndexDB() {\n    if (!window.indexedDB || !window.IDBKeyRange) {\n        return false;\n    }\n    return true;\n}\nfunction filterByAppKey(items, appKey) {\n    var returned = items.filter(function (item) {\n        return item.appKey === appKey;\n    });\n    return returned;\n}\nfunction asyncOpenDB() {\n    return __awaiter(this, void 0, void 0, function () {\n        var db;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4, openDB(DATABASE_NAME, DATABASE_VERSION, {\n                        upgrade: function (db) {\n                            var appListStore = db.createObjectStore(OBJECT_STORE_APP_STATUS);\n                            var logDetailsStore = db.createObjectStore(OBJECT_STORE_LOG_DETAIL, {\n                                keyPath: 'createTime',\n                                autoIncrement: true\n                            });\n                            logDetailsStore.createIndex('createTime', 'createTime');\n                            logDetailsStore.createIndex('appKey', 'appKey');\n                        }\n                    })];\n                case 1:\n                    db = _a.sent();\n                    return [2, db];\n            }\n        });\n    });\n}\nexport function asyncDeleteDB() {\n    return __awaiter(this, void 0, void 0, function () {\n        var result;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4, deleteDB(DATABASE_NAME)];\n                case 1:\n                    result = _a.sent();\n                    return [2, result];\n            }\n        });\n    });\n}\nfunction deleteTableRecord(db, totalSize, limitSize) {\n    return __awaiter(this, void 0, void 0, function () {\n        var currentSize, cursor, storedObject, contentLength;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    if (!db) {\n                        return [2, null];\n                    }\n                    currentSize = totalSize;\n                    return [4, db\n                            .transaction(OBJECT_STORE_LOG_DETAIL, 'readwrite')\n                            .store.index('createTime')\n                            .openCursor()];\n                case 1:\n                    cursor = _a.sent();\n                    _a.label = 2;\n                case 2:\n                    if (!cursor) return [3, 6];\n                    storedObject = cursor.value.content;\n                    currentSize;\n                    if (!(currentSize > limitSize)) return [3, 4];\n                    contentLength = getContentLength(storedObject);\n                    cursor.delete();\n                    currentSize -= contentLength;\n                    return [4, cursor.continue()];\n                case 3:\n                    cursor = _a.sent();\n                    return [3, 5];\n                case 4:\n                    cursor = null;\n                    _a.label = 5;\n                case 5: return [3, 2];\n                case 6:\n                    if (!(currentSize !== totalSize)) return [3, 8];\n                    return [4, db.put(OBJECT_STORE_APP_STATUS, {\n                            totalSize: currentSize\n                        }, 'totalSize')];\n                case 7:\n                    _a.sent();\n                    _a.label = 8;\n                case 8: return [2, currentSize];\n            }\n        });\n    });\n}\nexport function asyncSave(bytesQuota, appKey, content, enableConsole) {\n    return inQueue(function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var db, appTotalSize, totalSizeItem, lastTotalSize, contentLength, now, item;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4, asyncOpenDB()];\n                    case 1:\n                        db = _a.sent();\n                        appTotalSize = 0;\n                        return [4, db.get(OBJECT_STORE_APP_STATUS, 'totalSize')];\n                    case 2:\n                        totalSizeItem = _a.sent();\n                        lastTotalSize = totalSizeItem ? totalSizeItem.totalSize : 0;\n                        contentLength = getContentLength(content);\n                        appTotalSize += lastTotalSize;\n                        appTotalSize += contentLength;\n                        now = Date.now();\n                        return [4, db.add(OBJECT_STORE_LOG_DETAIL, {\n                                createTime: now,\n                                appKey: appKey,\n                                content: content\n                            })];\n                    case 3:\n                        item = _a.sent();\n                        if (!(appTotalSize > bytesQuota)) return [3, 5];\n                        console.error('存满');\n                        return [4, deleteTableRecord(db, appTotalSize, 0.7 * bytesQuota)];\n                    case 4:\n                        _a.sent();\n                        return [3, 7];\n                    case 5: return [4, db.put(OBJECT_STORE_APP_STATUS, {\n                            totalSize: appTotalSize\n                        }, 'totalSize')];\n                    case 6:\n                        _a.sent();\n                        _a.label = 7;\n                    case 7:\n                        db.close();\n                        return [2, item];\n                }\n            });\n        });\n    });\n}\nexport function asyncGetByDateRange(appKey, startDate, endDate, enableConsole) {\n    return __awaiter(this, void 0, void 0, function () {\n        var db, items;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4, asyncOpenDB()];\n                case 1:\n                    db = _a.sent();\n                    return [4, db.getAll(OBJECT_STORE_LOG_DETAIL, IDBKeyRange.bound(startDate, endDate))];\n                case 2:\n                    items = _a.sent();\n                    db.close();\n                    devConsole(enableConsole, MESSAGES.MESSAGE_LOG_ITEMS, items);\n                    return [2, filterByAppKey(items, appKey)];\n            }\n        });\n    });\n}\nexport function asyncQueryByContent(appKey, queryStr, enableConsole) {\n    return __awaiter(this, void 0, void 0, function () {\n        var db, items, cursor, content;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4, asyncOpenDB()];\n                case 1:\n                    db = _a.sent();\n                    items = [];\n                    return [4, db\n                            .transaction(OBJECT_STORE_LOG_DETAIL, 'readwrite')\n                            .store.index('createTime')\n                            .openCursor()];\n                case 2:\n                    cursor = _a.sent();\n                    _a.label = 3;\n                case 3:\n                    if (!cursor) return [3, 5];\n                    content = cursor.value.content;\n                    if (content.c.indexOf(queryStr) > -1) {\n                        items.push(cursor.value);\n                    }\n                    return [4, cursor.continue()];\n                case 4:\n                    cursor = _a.sent();\n                    return [3, 3];\n                case 5:\n                    devConsole(enableConsole, MESSAGES.MESSAGE_LOG_ITEMS, items);\n                    return [2, filterByAppKey(items, appKey)];\n            }\n        });\n    });\n}\n","export function getEnvInfo() {\n    var navigator = window.navigator;\n    var connection = navigator.connection;\n    return {\n        network: {\n            effectiveType: connection.effectiveType,\n            rtt: connection.rtt,\n            downlink: connection.downlink\n        },\n        platform: navigator.platform,\n        deviceMemory: navigator.deviceMemory,\n        userAgent: navigator.userAgent\n    };\n}\nexport function getErrorInfo() {\n    try {\n        throw new Error('traceError');\n    }\n    catch (e) {\n        return e.stack;\n    }\n}\nexport function getEventInfo() { }\nexport function getPageInfo() { }\n","import { __read, __values } from \"tslib\";\nvar HEADERS = {\n    CONTENT_TYPE: 'content-type',\n    ACCEPT: 'accept'\n};\nvar headerBuilders = [];\nfunction parseHeaders(rawHeaders) {\n    var e_1, _a;\n    if (rawHeaders === void 0) { rawHeaders = ''; }\n    var result = {};\n    try {\n        for (var _b = __values(rawHeaders.trim().split('\\n')), _c = _b.next(); !_c.done; _c = _b.next()) {\n            var line = _c.value;\n            var _d = __read(line.split(':')), key = _d[0], values = _d.slice(1);\n            result[key.toLowerCase()] = values.join(':').trim();\n        }\n    }\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\n    finally {\n        try {\n            if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n        }\n        finally { if (e_1) throw e_1.error; }\n    }\n    return result;\n}\nexport function request(_a) {\n    var url = _a.url, _b = _a.method, method = _b === void 0 ? 'get' : _b, _c = _a.headers, headers = _c === void 0 ? {} : _c, json = _a.json, data = _a.data, body = _a.body, _d = _a.timeout, timeout = _d === void 0 ? 0 : _d;\n    return new Promise(function (resolve, reject) {\n        var e_2, _a, e_3, _b, e_4, _c;\n        if ((json && data) || (json && body) || (data && json)) {\n            throw new Error(\"Only options.json or options.data or options.body should be passed\");\n        }\n        var normalizedHeaders = {};\n        try {\n            for (var _d = __values(Object.keys(headers)), _e = _d.next(); !_e.done; _e = _d.next()) {\n                var key = _e.value;\n                normalizedHeaders[key.toLowerCase()] = headers[key];\n            }\n        }\n        catch (e_2_1) { e_2 = { error: e_2_1 }; }\n        finally {\n            try {\n                if (_e && !_e.done && (_a = _d.return)) _a.call(_d);\n            }\n            finally { if (e_2) throw e_2.error; }\n        }\n        if (json) {\n            normalizedHeaders[HEADERS.CONTENT_TYPE] =\n                normalizedHeaders[HEADERS.CONTENT_TYPE] || 'application/json';\n        }\n        else if (data || body) {\n            normalizedHeaders[HEADERS.CONTENT_TYPE] =\n                normalizedHeaders[HEADERS.CONTENT_TYPE] ||\n                    'application/x-www-form-urlencoded; charset=utf-8';\n        }\n        normalizedHeaders[HEADERS.ACCEPT] = normalizedHeaders[HEADERS.ACCEPT] || 'application/json';\n        try {\n            for (var headerBuilders_1 = __values(headerBuilders), headerBuilders_1_1 = headerBuilders_1.next(); !headerBuilders_1_1.done; headerBuilders_1_1 = headerBuilders_1.next()) {\n                var headerBuilder = headerBuilders_1_1.value;\n                var builtHeaders = headerBuilder();\n                try {\n                    for (var _f = (e_4 = void 0, __values(Object.keys(builtHeaders))), _g = _f.next(); !_g.done; _g = _f.next()) {\n                        var key = _g.value;\n                        normalizedHeaders[key.toLowerCase()] = builtHeaders[key];\n                    }\n                }\n                catch (e_4_1) { e_4 = { error: e_4_1 }; }\n                finally {\n                    try {\n                        if (_g && !_g.done && (_c = _f.return)) _c.call(_f);\n                    }\n                    finally { if (e_4) throw e_4.error; }\n                }\n            }\n        }\n        catch (e_3_1) { e_3 = { error: e_3_1 }; }\n        finally {\n            try {\n                if (headerBuilders_1_1 && !headerBuilders_1_1.done && (_b = headerBuilders_1.return)) _b.call(headerBuilders_1);\n            }\n            finally { if (e_3) throw e_3.error; }\n        }\n        var xhr = new XMLHttpRequest();\n        xhr.addEventListener('load', function xhrLoad() {\n            var responseHeaders = parseHeaders(this.getAllResponseHeaders());\n            if (!this.status) {\n                return reject(new Error(\"Request to \" + method.toLowerCase() + \" \" + url + \" failed: no response status code.\"));\n            }\n            var contentType = responseHeaders['content-type'];\n            var isJSON = contentType &&\n                (contentType.indexOf('application/json') === 0 || contentType.indexOf('text/json') === 0);\n            var responseBody = this.responseText;\n            try {\n                responseBody = JSON.parse(responseBody);\n            }\n            catch (err) {\n                if (isJSON) {\n                    return reject(new Error(\"Invalid json: \" + this.responseText + \".\"));\n                }\n            }\n            var res = {\n                status: this.status,\n                headers: responseHeaders,\n                body: responseBody\n            };\n            return resolve(res);\n        }, false);\n        xhr.addEventListener('error', function (evt) {\n            reject(new Error(\"Request to \" + method.toLowerCase() + \" \" + url + \" failed: \" + evt.toString() + \".\"));\n        }, false);\n        xhr.open(method, url, true);\n        for (var key in normalizedHeaders) {\n            if (normalizedHeaders.hasOwnProperty(key)) {\n                xhr.setRequestHeader(key, normalizedHeaders[key]);\n            }\n        }\n        if (json) {\n            body = JSON.stringify(json);\n        }\n        else if (data) {\n            body = Object.keys(data)\n                .map(function (key) {\n                return encodeURIComponent(key) + \"=\" + (data ? encodeURIComponent(data[key]) : '');\n            })\n                .join('&');\n        }\n        xhr.timeout = timeout;\n        xhr.ontimeout = function xhrTimeout() {\n            reject(new Error(\"Request to \" + method.toLowerCase() + \" \" + url + \" has timed out\"));\n        };\n        xhr.send(body);\n    });\n}\nexport function addHeaderBuilder(method) {\n    headerBuilders.push(method);\n}\n","import { __awaiter, __generator, __read, __values } from \"tslib\";\nimport { request } from './http';\nimport { inQueue, debounce } from './util';\nimport { getEnvInfo } from './env';\nvar reportQueueGroups = new Map();\nvar oneKBytes = 1 * 1024;\nvar oneMBytes = 1 * 1024 * 1024;\nvar concurrencyRequestLimit = 5;\nvar requestDebounceTime = 1500;\nvar debounceRequest = debounce(executeQueueGroup, requestDebounceTime);\nexport var immediatelyReportToServer = function (url, data, enableSendBeacon) {\n    var supportBeacon = navigator.sendBeacon;\n    if (supportBeacon && enableSendBeacon) {\n        var formData_1 = objectToFormData(data);\n        return new Promise(function (resolve, reject) {\n            var res = navigator.sendBeacon(url, formData_1);\n            if (res) {\n                resolve(res);\n            }\n            else {\n                reject(res);\n            }\n        });\n    }\n    return request({ url: url, method: 'post', json: data, timeout: 1000 });\n};\nexport var reportToServer = function (url, bizInfo, enableSendBeacon) {\n    var len = bizInfo.length;\n    var bizInfoSize = bizInfo ? JSON.stringify(bizInfo).length : 0;\n    var queueGroup;\n    if (reportQueueGroups.has(url)) {\n        queueGroup = reportQueueGroups.get(url);\n    }\n    else {\n        queueGroup = {\n            queue: [],\n            lastBizInfoSize: 0,\n            enableSendBeacon: enableSendBeacon\n        };\n        reportQueueGroups.set(url, queueGroup);\n    }\n    if (bizInfoSize < oneKBytes) {\n        if (queueGroup.lastBizInfoSize > 1 * oneMBytes) {\n            queueGroup.queue.push([]);\n            queueGroup.lastBizInfoSize = 0;\n        }\n        if (queueGroup.queue.length === 0) {\n            queueGroup.queue.push([]);\n        }\n        bizInfo.forEach(function (item) {\n            queueGroup.queue[queueGroup.queue.length - 1].push(item);\n        });\n        queueGroup.lastBizInfoSize += bizInfoSize;\n    }\n    else if (bizInfoSize > 2 * oneMBytes) {\n        var piecesNum = Math.round(bizInfoSize / oneMBytes);\n        var sliceLen = Math.floor(len / piecesNum);\n        for (var i = 0; i < piecesNum; i++) {\n            var bizInfoPiece = bizInfo.slice(i * sliceLen, (i + 1) * sliceLen);\n            queueGroup.queue.push(bizInfoPiece);\n            queueGroup.lastBizInfoSize = oneMBytes;\n        }\n    }\n    debounceRequest();\n};\nfunction executeQueueGroup() {\n    var e_1, _a;\n    var envInfo = getEnvInfo();\n    try {\n        for (var reportQueueGroups_1 = __values(reportQueueGroups), reportQueueGroups_1_1 = reportQueueGroups_1.next(); !reportQueueGroups_1_1.done; reportQueueGroups_1_1 = reportQueueGroups_1.next()) {\n            var _b = __read(reportQueueGroups_1_1.value, 2), url = _b[0], queueGroup = _b[1];\n            var queue = queueGroup.queue;\n            var enableSendBeacon = queueGroup.enableSendBeacon;\n            var promiseArrs = [];\n            var promiseArr = void 0;\n            var i = 0;\n            while (queue.length > 0) {\n                var bizInfo = queue.shift();\n                if (i % concurrencyRequestLimit === 0) {\n                    promiseArr = [];\n                }\n                promiseArr.push(immediatelyReportToServer(url, {\n                    bizInfo: bizInfo,\n                    envInfo: envInfo\n                }, enableSendBeacon));\n                queueGroup.lastBizInfoSize = 0;\n                if (i % concurrencyRequestLimit === 0) {\n                    promiseArrs.push(promiseArr);\n                }\n                i++;\n            }\n            promiseArrs.forEach(function (promiseArr) {\n                inQueue(function () {\n                    return __awaiter(this, void 0, void 0, function () {\n                        return __generator(this, function (_a) {\n                            switch (_a.label) {\n                                case 0: return [4, Promise.all(promiseArr)];\n                                case 1:\n                                    _a.sent();\n                                    return [2];\n                            }\n                        });\n                    });\n                });\n            });\n        }\n    }\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\n    finally {\n        try {\n            if (reportQueueGroups_1_1 && !reportQueueGroups_1_1.done && (_a = reportQueueGroups_1.return)) _a.call(reportQueueGroups_1);\n        }\n        finally { if (e_1) throw e_1.error; }\n    }\n}\nfunction objectToFormData(data) {\n    var formData = new FormData();\n    for (var key in data) {\n        if (data.hasOwnProperty(key)) {\n            formData.append(key, data[key]);\n        }\n    }\n    return formData;\n}\n","import { __awaiter, __decorate, __generator } from \"tslib\";\nimport { levelEnum } from './interface';\nimport { isSupportIndexDB, asyncSave, asyncGetByDateRange, asyncQueryByContent, asyncDeleteDB } from './storage';\nimport { getEnvInfo, getErrorInfo } from './env';\nimport { isBrowser, wrapContent, devConsole } from './util';\nimport { immediatelyReportToServer, reportToServer } from './report';\nimport { ERRORS, MESSAGES, M_BYTES, APP_KEY_ANONYMOUS } from './constants';\nvar notInBrowser = !isBrowser();\nfunction noop() { }\nfunction verifyInBrowser(target, propertyKey, descriptor) {\n    var originalFunc = descriptor.value;\n    descriptor.value = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        return __awaiter(this, void 0, void 0, function () {\n            var result;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (notInBrowser)\n                            return [2, Promise.reject(ERRORS.ERR_NOT_SUPPORTED)];\n                        return [4, originalFunc.apply(this, args)];\n                    case 1:\n                        result = _a.sent();\n                        return [2, result];\n                }\n            });\n        });\n    };\n}\nfunction proxySaveLog(level) {\n    if (notInBrowser)\n        return noop;\n    return function saveLog(bytesQuota, appKey, content, userId, enableConsole) {\n        if (!isSupportIndexDB()) {\n            throw new Error(ERRORS.ERR_STORAGE);\n        }\n        var wrappedContent = getWrappedContent(content, level, userId);\n        devConsole(enableConsole, MESSAGES.MESSAGE_LOG_CONTENT, wrappedContent);\n        return asyncSave(bytesQuota, appKey, wrappedContent, enableConsole);\n    };\n}\nfunction getWrappedContent(content, level, userId) {\n    var url = location.href;\n    var wrappedContent = wrapContent(content, level, url, userId);\n    return wrappedContent;\n}\nfunction formatReportData(queryData) {\n    var returned = [];\n    queryData.forEach(function (item) {\n        returned.push(contentToBizInfo(item.appKey, item.content));\n    });\n    return returned;\n}\nfunction contentToBizInfo(appKey, content) {\n    return {\n        appKey: appKey,\n        content: content.c,\n        type: levelEnum[content.l],\n        created: content.t,\n        url: content.ul,\n        userId: content.ud\n    };\n}\nvar WoodpeckerLogger = (function () {\n    function WoodpeckerLogger(_a) {\n        var _b = _a === void 0 ? {} : _a, _c = _b.appKey, appKey = _c === void 0 ? APP_KEY_ANONYMOUS : _c, _d = _b.bytesQuota, bytesQuota = _d === void 0 ? 10 * M_BYTES : _d, _e = _b.reportUrl, reportUrl = _e === void 0 ? '' : _e, _f = _b.enableSendBeacon, enableSendBeacon = _f === void 0 ? false : _f, _g = _b.userId, userId = _g === void 0 ? '' : _g, _h = _b.enableConsole, enableConsole = _h === void 0 ? false : _h;\n        if (notInBrowser)\n            return;\n        if (typeof appKey !== 'string' ||\n            typeof bytesQuota !== 'number' ||\n            (reportUrl && typeof reportUrl !== 'string')) {\n            throw new Error(ERRORS.ERR_CONFIG_SDK_INIT_OPTION);\n        }\n        if (reportUrl === '') {\n            devConsole(enableConsole, MESSAGES.MESSAGE_REPORT_URL);\n        }\n        this.options = {\n            appKey: appKey,\n            bytesQuota: bytesQuota,\n            reportUrl: reportUrl,\n            enableSendBeacon: enableSendBeacon,\n            userId: userId,\n            enableConsole: enableConsole\n        };\n    }\n    WoodpeckerLogger.deleteLogDB = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4, asyncDeleteDB()];\n                    case 1: return [2, _a.sent()];\n                }\n            });\n        });\n    };\n    WoodpeckerLogger.prototype.trace = function (content, userId) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2, proxySaveLog('trace')(this.options.bytesQuota, this.options.appKey, content, userId || this.options.userId, this.options.enableConsole)];\n            });\n        });\n    };\n    WoodpeckerLogger.prototype.info = function (content, userId) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2, proxySaveLog('info')(this.options.bytesQuota, this.options.appKey, content, userId || this.options.userId, this.options.enableConsole)];\n            });\n        });\n    };\n    WoodpeckerLogger.prototype.warn = function (content, userId) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2, proxySaveLog('warn')(this.options.bytesQuota, this.options.appKey, content, userId || this.options.userId, this.options.enableConsole)];\n            });\n        });\n    };\n    WoodpeckerLogger.prototype.error = function (content, userId) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2, proxySaveLog('error')(this.options.bytesQuota, this.options.appKey, content, userId || this.options.userId, this.options.enableConsole)];\n            });\n        });\n    };\n    WoodpeckerLogger.prototype.fatal = function (content, userId) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2, proxySaveLog('fatal')(this.options.bytesQuota, this.options.appKey, content, userId || this.options.userId, this.options.enableConsole)];\n            });\n        });\n    };\n    WoodpeckerLogger.prototype.assert = function (assertion, content, userId) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, appKey, reportUrl, bytesQuota, enableSendBeacon, enableConsole, optionsUserInd, returned, level, traceInfo, assertContent, wrapContent_1, bizInfo, envInfo;\n            return __generator(this, function (_b) {\n                _a = this.options, appKey = _a.appKey, reportUrl = _a.reportUrl, bytesQuota = _a.bytesQuota, enableSendBeacon = _a.enableSendBeacon, enableConsole = _a.enableConsole;\n                optionsUserInd = this.options.userId;\n                returned = {};\n                if (enableConsole) {\n                    console.assert(assertion, content);\n                }\n                if (false === assertion) {\n                    level = 'assert';\n                    traceInfo = JSON.stringify(getErrorInfo());\n                    assertContent = \"Assertion failed. Check the stack \" + traceInfo + \". Log content:\" + content;\n                    wrapContent_1 = getWrappedContent(assertContent, level, userId);\n                    proxySaveLog(level)(bytesQuota, appKey, assertContent, userId || optionsUserInd, enableConsole);\n                    if (reportUrl) {\n                        bizInfo = [];\n                        bizInfo.push(contentToBizInfo(appKey, wrapContent_1));\n                        envInfo = getEnvInfo();\n                        return [2, reportToServer(reportUrl, bizInfo, enableSendBeacon)];\n                    }\n                }\n                return [2];\n            });\n        });\n    };\n    WoodpeckerLogger.prototype.queryByDays = function (days) {\n        if (days === void 0) { days = -1; }\n        return __awaiter(this, void 0, void 0, function () {\n            var endDate, startDate, queryResult;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (typeof days !== 'number') {\n                            throw new Error(ERRORS.ERR_QUERY_DATE_PARAMETER);\n                        }\n                        if (days > 0) {\n                            days = -days;\n                        }\n                        endDate = new Date().getTime();\n                        startDate = endDate + days * 24 * 60 * 60 * 1000;\n                        return [4, asyncGetByDateRange(this.options.appKey, startDate, endDate, this.options.enableConsole)];\n                    case 1:\n                        queryResult = _a.sent();\n                        return [2, queryResult];\n                }\n            });\n        });\n    };\n    WoodpeckerLogger.prototype.queryByContent = function (content) {\n        return __awaiter(this, void 0, void 0, function () {\n            var queryResult;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4, asyncQueryByContent(this.options.appKey, content, this.options.enableConsole)];\n                    case 1:\n                        queryResult = _a.sent();\n                        return [2, queryResult];\n                }\n            });\n        });\n    };\n    WoodpeckerLogger.prototype.report = function (days, isSendImmediately) {\n        if (days === void 0) { days = -1; }\n        if (isSendImmediately === void 0) { isSendImmediately = false; }\n        return __awaiter(this, void 0, void 0, function () {\n            var envInfo, _a, reportUrl, enableSendBeacon, queryResult, bizInfo;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        if (notInBrowser)\n                            return [2, false];\n                        envInfo = getEnvInfo();\n                        _a = this.options, reportUrl = _a.reportUrl, enableSendBeacon = _a.enableSendBeacon;\n                        return [4, this.queryByDays(days)];\n                    case 1:\n                        queryResult = _b.sent();\n                        bizInfo = formatReportData(queryResult);\n                        if (reportUrl) {\n                            if (isSendImmediately) {\n                                return [2, immediatelyReportToServer(reportUrl, {\n                                        bizInfo: bizInfo,\n                                        envInfo: envInfo\n                                    }, enableSendBeacon)];\n                            }\n                            return [2, reportToServer(reportUrl, bizInfo, enableSendBeacon)];\n                        }\n                        return [2];\n                }\n            });\n        });\n    };\n    __decorate([\n        verifyInBrowser\n    ], WoodpeckerLogger.prototype, \"queryByDays\", null);\n    __decorate([\n        verifyInBrowser\n    ], WoodpeckerLogger.prototype, \"queryByContent\", null);\n    __decorate([\n        verifyInBrowser\n    ], WoodpeckerLogger.prototype, \"report\", null);\n    return WoodpeckerLogger;\n}());\nexport default WoodpeckerLogger;\n"],"names":["__decorate","decorators","target","key","desc","d","c","arguments","length","r","Object","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","__generator","body","f","y","t","g","_","label","sent","trys","ops","verb","throw","return","Symbol","iterator","this","n","v","op","TypeError","call","pop","push","__values","o","s","m","__read","ar","error","ERRORS","MESSAGES","levelEnum","DATABASE_NAME","OBJECT_STORE_APP_STATUS","OBJECT_STORE_LOG_DETAIL","idbProxyableTypes","cursorAdvanceMethods","cursorRequestMap","WeakMap","transactionDoneMap","transactionStoreNamesMap","transformCache","reverseTransformCache","idbProxyTraps","[object Object]","prop","receiver","IDBTransaction","get","objectStoreNames","undefined","objectStore","wrap","set","has","wrapFunction","func","IDBDatabase","prototype","transaction","IDBCursor","advance","continue","continuePrimaryKey","includes","args","unwrap","storeNames","tx","sort","transformCachableValue","unlisten","removeEventListener","complete","DOMException","addEventListener","cacheDonePromiseForTransaction","object","IDBObjectStore","IDBIndex","some","Proxy","IDBRequest","request","promise","success","catch","promisifyRequest","newValue","openDB","name","version","blocked","upgrade","blocking","terminated","indexedDB","open","openPromise","event","oldVersion","newVersion","db","deleteDB","deleteDatabase","readMethods","writeMethods","cachedMethods","Map","getMethod","targetFuncName","replace","useIndex","isWrite","method","async","storeName","store","index","shift","returnVal","oldTraps","callback","queue","isCandidatePending","getContentLength","content","JSON","stringify","devConsole","enableConsole","_i","unshift","console","log","doPromiseInQueue","candidate","lastResult","err_1","_a","asyncFunction","inQueue","filterByAppKey","items","appKey","filter","item","asyncOpenDB","createObjectStore","logDetailsStore","keyPath","autoIncrement","createIndex","asyncDeleteDB","deleteTableRecord","totalSize","limitSize","currentSize","cursor","storedObject","contentLength","openCursor","delete","put","asyncGetByDateRange","startDate","endDate","getAll","IDBKeyRange","bound","close","MESSAGE_LOG_ITEMS","asyncQueryByContent","queryStr","indexOf","getEnvInfo","navigator","window","connection","network","effectiveType","rtt","downlink","platform","deviceMemory","userAgent","HEADERS","headerBuilders","url","_b","_c","headers","json","data","_d","timeout","e_2","e_3","e_4","Error","normalizedHeaders","keys","_e","toLowerCase","e_2_1","headerBuilders_1","headerBuilders_1_1","builtHeaders","headerBuilder","_f","_g","e_4_1","e_3_1","xhr","XMLHttpRequest","responseHeaders","rawHeaders","e_1","trim","split","values","slice","join","e_1_1","parseHeaders","getAllResponseHeaders","status","contentType","isJSON","responseBody","responseText","parse","err","res","evt","toString","hasOwnProperty","setRequestHeader","map","encodeURIComponent","ontimeout","send","time","reportQueueGroups","oneMBytes","debounceRequest","envInfo","reportQueueGroups_1","reportQueueGroups_1_1","queueGroup","enableSendBeacon","promiseArrs","promiseArr","bizInfo","immediatelyReportToServer","lastBizInfoSize","forEach","all","clearTimeout","setTimeout","sendBeacon","formData_1","formData","FormData","append","objectToFormData","reportToServer","len","bizInfoSize","piecesNum","Math","round","sliceLen","floor","bizInfoPiece","notInBrowser","location","noop","verifyInBrowser","propertyKey","descriptor","originalFunc","ERR_NOT_SUPPORTED","proxySaveLog","level","bytesQuota","userId","ERR_STORAGE","wrappedContent","getWrappedContent","MESSAGE_LOG_CONTENT","appTotalSize","totalSizeItem","lastTotalSize","now","Date","add","createTime","asyncSave","l","ul","ud","wrapContent","href","contentToBizInfo","type","created","WoodpeckerLogger","reportUrl","_h","ERR_CONFIG_SDK_INIT_OPTION","MESSAGE_REPORT_URL","options","deleteLogDB","trace","info","warn","fatal","assert","assertion","optionsUserInd","traceInfo","assertContent","wrapContent_1","stack","getErrorInfo","queryByDays","days","ERR_QUERY_DATE_PARAMETER","getTime","queryByContent","report","isSendImmediately","queryResult","returned"],"mappings":"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"}